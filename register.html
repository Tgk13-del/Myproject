<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
    }

    .register-container {
      display: flex;
      height: auto;
    }

    .left-panel {
      flex: 1;
      background-color: rgb(255, 85, 0);
      color: white;
      padding: 40px;
      text-align: center;
    }

    .right-panel {
      flex: 1;
      background: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS9zrNB1dnNIHN6YlK3fZCOOBPnAc_dqaprWA&s') center center/cover no-repeat;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: none;
      border-radius: 10px;
    }

    .btn-register {
      background-color: #39658e;
      color: white;
      border: none;
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      border-radius: 10px;
      font-size: 18px;
    }

    .register-link {
      color: #ffffff;
      display: inline-block;
    }

    label {
      float: left;
      font-size: 14px;
      margin-top: 10px;
    }

    .form-check {
      font-size: 13px;
      text-align: left;
      margin-top: 10px;
    }

    /* small helper text under inputs */
    .helper {
      color: #fff;
      font-size: 12px;
      text-align: left;
      margin-bottom: 8px;
      display: none;
    }

    /* show helper when error */
    .helper.show {
      display: block;
    }
  </style>
</head>
<body>

<div class="register-container">
  <div class="left-panel">
    <h6 style="margin-bottom: 5px;">The Unique Shop</h6>
    <h3 class="mb-4">Create an account</h3>
    <form id="registerForm" novalidate>
      <label for="username">Username</label>
      <input type="text" id="username" required />
      <div id="usernameHelper" class="helper">Username must be at least 6 characters.</div>

      <label for="email">Email</label>
      <input type="email" id="email" required />
      <div id="emailHelper" class="helper">Please enter a valid email address.</div>

      <label for="password">Password</label>
      <input type="password" id="password" required />
      <div id="passwordHelper" class="helper">
        Password must be at least 8 characters and include lowercase, uppercase, number and special character.
      </div>

      <label for="confirmPassword">Confirm password</label>
      <input type="password" id="confirmPassword" required />
      <div id="confirmHelper" class="helper">Passwords must match.</div>

      <div class="form-check">
        <input type="checkbox" class="form-check-input" id="privacyCheck" />
        <label class="form-check-label" for="privacyCheck">
          I have read and agree to The Unique Shopâ€™s privacy policy
        </label>
      </div>

      <button type="submit" class="btn-register">Sign Up</button>
      <a href="login.html" class="register-link"> Already have an account?</a>
    </form>
  </div>
  <div class="right-panel"></div>
</div>

<script>
  // Select form elements
  const form = document.getElementById('registerForm');
  const usernameInput = document.getElementById('username');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const confirmInput = document.getElementById('confirmPassword');
  const privacyCheck = document.getElementById('privacyCheck');

  // Helpers for showing small messages below inputs (optional)
  const usernameHelper = document.getElementById('usernameHelper');
  const emailHelper = document.getElementById('emailHelper');
  const passwordHelper = document.getElementById('passwordHelper');
  const confirmHelper = document.getElementById('confirmHelper');

  // Regex rules
  const lowerCaseLetter = /[a-z]/;
  const upperCaseLetter = /[A-Z]/;
  const numbers = /[0-9]/;
  const specialChar = /[^A-Za-z0-9]/;
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  function showHelper(helperEl, show) {
    if (show) helperEl.classList.add('show');
    else helperEl.classList.remove('show');
  }

  // Optional: live feedback as the user types
  usernameInput.addEventListener('input', () => {
    showHelper(usernameHelper, usernameInput.value.trim().length > 0 && usernameInput.value.trim().length < 6);
  });

  emailInput.addEventListener('input', () => {
    showHelper(emailHelper, emailInput.value.trim().length > 0 && !emailRegex.test(emailInput.value.trim()));
  });

  passwordInput.addEventListener('input', () => {
    const val = passwordInput.value;
    const missing =
      val.length < 8 ||
      !lowerCaseLetter.test(val) ||
      !upperCaseLetter.test(val) ||
      !numbers.test(val) ||
      !specialChar.test(val);
    showHelper(passwordHelper, val.length > 0 && missing);
  });

  confirmInput.addEventListener('input', () => {
    showHelper(confirmHelper, confirmInput.value.length > 0 && confirmInput.value !== passwordInput.value);
  });

  // Main submit handler
  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const username = usernameInput.value.trim();
    const email = emailInput.value.trim().toLowerCase();
    const password = passwordInput.value;       // keep original (not trimmed) for password checks
    const confirmPassword = confirmInput.value;
    const agreed = privacyCheck.checked;

    // Reset helpers
    showHelper(usernameHelper, false);
    showHelper(emailHelper, false);
    showHelper(passwordHelper, false);
    showHelper(confirmHelper, false);

    // Basic presence check
    if (!username || !email || !password || !confirmPassword) {
      alert('Please fill in all fields.');
      return;
    }

    // Username length
    if (username.length < 6) {
      showHelper(usernameHelper, true);
      alert('Username must be at least 6 characters.');
      return;
    }

    // Email format
    if (!emailRegex.test(email)) {
      showHelper(emailHelper, true);
      alert('Please enter a valid email address.');
      return;
    }

    // Password length
    if (password.length < 8) {
      showHelper(passwordHelper, true);
      alert('Password must be at least 8 characters long.');
      return;
    }

    // Lowercase check
    if (!lowerCaseLetter.test(password)) {
      showHelper(passwordHelper, true);
      alert('Password must contain at least one lowercase letter.');
      return;
    }

    // Uppercase check
    if (!upperCaseLetter.test(password)) {
      showHelper(passwordHelper, true);
      alert('Password must contain at least one uppercase letter.');
      return;
    }

    // Number check
    if (!numbers.test(password)) {
      showHelper(passwordHelper, true);
      alert('Password must contain at least one number.');
      return;
    }

    // Special character check
    if (!specialChar.test(password)) {
      showHelper(passwordHelper, true);
      alert('Password must contain at least one special character.');
      return;
    }

    // Confirm password
    if (password !== confirmPassword) {
      showHelper(confirmHelper, true);
      alert('Passwords do not match.');
      return;
    }

    // Privacy checkbox
    if (!agreed) {
      alert('You must agree to the privacy policy.');
      return;
    }

    // Now handle storage of users in localStorage as an array
    // We also prevent duplicate email or username
    let users = [];
    try {
      const raw = localStorage.getItem('users');
      if (raw) {
        users = JSON.parse(raw);
        if (!Array.isArray(users)) {
          users = [];
        }
      }
    } catch (err) {
      // if parse error, reset users
      users = [];
    }

    // check duplicates
    const emailExists = users.some(u => u.email === email);
    if (emailExists) {
      alert('An account with this email already exists. Please use another email or login.');
      return;
    }

    const usernameExists = users.some(u => u.username.toLowerCase() === username.toLowerCase());
    if (usernameExists) {
      alert('Username already taken. Please choose a different username.');
      return;
    }

    // Prepare user object
    const newUser = {
      username,
      email,
      password, // NOTE: For real apps, never store plaintext passwords. This is demo-only.
      createdAt: new Date().toISOString()
    };

    // push and save
    users.push(newUser);
    localStorage.setItem('users', JSON.stringify(users));

    // Success
    alert('Registration successful! You can now log in.');

    // Redirect to login page
    // Use location.href so it works in most environments
    location.href = 'login.html';
  });
</script>

</body>
</html>
